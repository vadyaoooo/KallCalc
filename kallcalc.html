<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>КБЖУ</title>
    <style>
        body {
            font-family: 'asd';
            background-color: #181818;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: normal;
            margin: 15;
            padding: 0;
        }

        #calories-bar {
            width: 100%;
            height: 10px;
            background: #222222;
            border-radius: 10px;
            margin: 0px 0;
            position: relative;
        }

        #calories-fill {
            height: 100%;
            background-color: #68B96A;
            border-radius: 10px;
            position: absolute;
            top: 0;
            left: 0;
        }

        .macros {
            display: flex;
            flex-direction: column;
            width: 100%;
            margin: 20px 0;
        }

        .macro-bar {
            width: 100%;
            height: 10px;
            background: #222222;
            border-radius: 10px;
            margin: 2px 0;
            position: relative;
        }

        .macro-fill {
            height: 100%;
            border-radius: 10px;
            position: absolute;
            top: 0;
            left: 0;
        }

        .macro-info {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            margin-bottom: 2px;
            margin-left: 3px;
        }

        .input-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 10px;
        }

        .input-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        input[type="number"] {
            padding: 5px;
            border: none;
            border-radius: 5px;
            background-color: #222222;
            color: white;
            width: 100px;
            text-align: center;
        }

        .record {
            background: #222222;
            border-radius: 15px;
            padding: 5px;
            margin: 1px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
        }

        .record span {
            flex-grow: 1;
            text-align: left;
        }

        .record button {
            margin-left: 10px;
            background-color: #ff4747;
            border: none;
            color: white;
            padding: 5px;
            border-radius: 5px;
            cursor: pointer;
        }

        .record button:hover {
            background-color: #ff2929;
        }

        .records-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 400px;
            overflow-y: auto;
            max-height: 300px;
            border-radius: 10px;
            padding: 0px;
            background: #222222;
            margin: 0 auto;
        }

        button {
            margin-top: 10px;
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 15px;
            margin: 4px 2px;
            border-radius: 5px;
            transition: background-color 0.3s;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .settings-modal {
            background: #333333;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            border-radius: 10px;
            display: none;
            z-index: 10;
        }

        .settings-modal input {
            margin: 10px 0;
        }
    </style>
</head>
<body>

<div class="macro-info">
    <span id="calories-left" style="margin-bottom: 4px;">Можно съесть еще ? калорий</span>
</div>
<div id="calories-bar">
    <div id="calories-fill" style="width: 0%;"></div>
</div>
<div class="macro-info">
    <span id="calories-used" style="color: #68B96A; font-size: 14px; margin-top: 6px;">0 полученные калории</span>
    <span id="calories-all" style="margin-top: 6px; font-size: 14px;">Цель: ?</span>
</div>

<div class="macros">
    <div class="macro-info">
        <span id="protein-used">Белки: съедено ?</span>
        <span id="protein-left">осталось ?</span>
    </div>
    <div class="macro-bar" id="protein-bar">
        <div class="macro-fill" id="protein-fill" style="background-color: rgba(67, 167, 250, 0.973); width: 0%;"></div>
    </div>

    <div class="macro-info">
        <span id="fat-used">Жиры: съедено 0</span>
        <span id="fat-left">осталось ?</span>
    </div>
    <div class="macro-bar" id="fat-bar">
        <div class="macro-fill" id="fat-fill" style="background-color: rgba(254, 110, 61, 0.973); width: 0%;"></div>
    </div>

    <div class="macro-info">
        <span id="carb-used">Углеводы: съедено 0</span>
        <span id="carb-left">Осталось ?</span>
    </div>
    <div class="macro-bar" id="carb-bar">
        <div class="macro-fill" id="carb-fill" style="background-color: rgba(229, 68, 122, 0.973); width: 0%;"></div>
    </div>
</div>

<div class="input-container">
    <div class="input-row">
        <input type="number" id="fat-input" value="" placeholder="Жиры" pattern="[0-9]*">
        <input type="number" id="carb-input" value="" placeholder="Углеводы" pattern="[0-9]*">
        <input type="number" id="protein-input" value="" placeholder="Белки" pattern="[0-9]*">
    </div>
    <div class="checkbox-label">
        <input type="checkbox" id="training-day" onchange="toggleTrainingDay()">
        <label for="training-day">День тренировки</label>
    </div>
    <button onclick="addRecord()">Добавить</button>
    <button onclick="openSettings()">Настройки</button>
</div>

<div class="records-container" id="records-container"></div>

<button onclick="clearRecords()">Очистить все записи</button>

<div class="settings-modal" id="settings-modal">
    <div>
        <label for="gender-select">Пол:</label>
        <select id="gender-select">
            <option value="male">Мужской</option>
            <option value="female">Женский</option>
        </select>
    </div>
    <div>
        <label for="weight-input">Вес (кг):</label>
        <input type="number" id="weight-input" value="">
    </div>
    <button onclick="saveSettings()">Сохранить</button>
    <button onclick="closeSettings()">Закрыть</button>
</div>

<script>
    let records = JSON.parse(localStorage.getItem('records')) || [];
    let totalMacros = JSON.parse(localStorage.getItem('totalMacros')) || { protein: 0, fat: 0, carb: 0 };
    let isTrainingDay = JSON.parse(localStorage.getItem('isTrainingDay')) || false;
    let gender = localStorage.getItem('gender') || 'male';
    let weight = parseFloat(localStorage.getItem('weight')) || 70; // Default weight 70 kg

    const limits = {
        training: { protein: 0, fat: 0, carb: 0, calories: 0 },
        rest: { protein: 0, fat: 0, carb: 0, calories: 0 }
    };

    document.addEventListener('DOMContentLoaded', () => {
        updateUI();
        document.getElementById('training-day').checked = isTrainingDay;
    });

    function openSettings() {
        document.getElementById('settings-modal').style.display = 'block';
        document.getElementById('gender-select').value = gender;
        document.getElementById('weight-input').value = weight;
    }

    function closeSettings() {
        document.getElementById('settings-modal').style.display = 'none';
    }

    function saveSettings() {
        gender = document.getElementById('gender-select').value;
        weight = parseFloat(document.getElementById('weight-input').value);

        localStorage.setItem('gender', gender);
        localStorage.setItem('weight', weight);

        updateUI();
        closeSettings();
    }

    function toggleTrainingDay() {
        isTrainingDay = !isTrainingDay;
        localStorage.setItem('isTrainingDay', isTrainingDay);
        updateUI();
    }

    function updateUI() {
        const limitsToUse = isTrainingDay ? limits.training : limits.rest;

        if (weight) {
            let proteinMultiplier, fatMultiplier, carbMultiplier;

            if (isTrainingDay) {
                proteinMultiplier = gender === 'female' ? 1.3 : 2;
                fatMultiplier = gender === 'female' ? 1.2 : 1;
                carbMultiplier = 4;
            } else {
                proteinMultiplier = gender === 'female' ? 1.5 : 2.2;
                fatMultiplier = gender === 'female' ? 1 : 0.8;
                carbMultiplier = 2.2;
            }

            const calculatedProtein = Math.round(weight * proteinMultiplier);
            const calculatedFat = Math.round(weight * fatMultiplier);
            const calculatedCarb = Math.round(weight * carbMultiplier);

            limitsToUse.protein = calculatedProtein;
            limitsToUse.fat = calculatedFat;
            limitsToUse.carb = calculatedCarb;
            limitsToUse.calories = (calculatedProtein * 4) + (calculatedFat * 9) + (calculatedCarb * 4);
        }

        const proteinPercent = (totalMacros.protein / limitsToUse.protein) * 100;
        const fatPercent = (totalMacros.fat / limitsToUse.fat) * 100;
        const carbPercent = (totalMacros.carb / limitsToUse.carb) * 100;
        const calories = (totalMacros.protein * 4) + (totalMacros.fat * 9) + (totalMacros.carb * 4);
        const caloriesPercent = (calories / limitsToUse.calories) * 100;

        document.getElementById('protein-fill').style.width = `${proteinPercent}%`;
        document.getElementById('fat-fill').style.width = `${fatPercent}%`;
        document.getElementById('carb-fill').style.width = `${carbPercent}%`;
        document.getElementById('calories-fill').style.width = `${caloriesPercent}%`;

        document.getElementById('protein-used').textContent = `Белки: съедено ${totalMacros.protein}`;
        document.getElementById('protein-left').textContent = `осталось ${limitsToUse.protein - totalMacros.protein}`;

        document.getElementById('fat-used').textContent = `Жиры: съедено ${totalMacros.fat}`;
        document.getElementById('fat-left').textContent = `осталось ${limitsToUse.fat - totalMacros.fat}`;

        document.getElementById('carb-used').textContent = `Углеводы: съедено ${totalMacros.carb}`;
        document.getElementById('carb-left').textContent = `осталось ${limitsToUse.carb - totalMacros.carb}`;

        document.getElementById('calories-used').textContent = `${Math.round(calories)} полученные калории`;
        document.getElementById('calories-all').textContent = `Цель: ${limitsToUse.calories}`;
        document.getElementById('calories-left').textContent = `Можно съесть еще ${Math.round(limitsToUse.calories - calories)} калорий`;
    }

    function addRecord() {
        const protein = Math.round(parseFloat(document.getElementById('protein-input').value) || 0);
        const fat = Math.round(parseFloat(document.getElementById('fat-input').value) || 0);
        const carb = Math.round(parseFloat(document.getElementById('carb-input').value) || 0);

        if (protein || fat || carb) {
            const newRecord = { protein, fat, carb };
            records.push(newRecord);
            localStorage.setItem('records', JSON.stringify(records));

            totalMacros.protein += protein;
            totalMacros.fat += fat;
            totalMacros.carb += carb;
            localStorage.setItem('totalMacros', JSON.stringify(totalMacros));

            updateUI();
            renderRecords();
        }

        document.getElementById('protein-input').value = '';
        document.getElementById('fat-input').value = '';
        document.getElementById('carb-input').value = '';
    }

    function renderRecords() {
        const recordsContainer = document.getElementById('records-container');
        recordsContainer.innerHTML = '';
        records.forEach((record, index) => {
            const recordElement = document.createElement('div');
            recordElement.className = 'record';
            recordElement.innerHTML = `
                <span>Белки: ${record.protein} | Жиры: ${record.fat} | Углеводы: ${record.carb}</span>
                <button onclick="deleteRecord(${index})">Удалить</button>
            `;
            recordsContainer.appendChild(recordElement);
        });
    }

    function deleteRecord(index) {
        records.splice(index, 1);
        localStorage.setItem('records', JSON.stringify(records));

        totalMacros.protein -= records[index].protein;
        totalMacros.fat -= records[index].fat;
        totalMacros.carb -= records[index].carb;
        localStorage.setItem('totalMacros', JSON.stringify(totalMacros));

        updateUI();
        renderRecords();
    }

    function clearRecords() {
        if (confirm("Вы уверены, что хотите очистить все записи?")) {
            records = [];
            localStorage.setItem('records', JSON.stringify(records));

            totalMacros.protein = 0;
            totalMacros.fat = 0;
            totalMacros.carb = 0;
            localStorage.setItem('totalMacros', JSON.stringify(totalMacros));

            updateUI();
            renderRecords();
        }
    }

    renderRecords();
</script>

</body>
</html>
