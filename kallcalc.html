<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>КБЖУ</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #121212;
            color: #fff;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        h1 {
            font-size: 36px;
            margin-bottom: 30px;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            background-color: #1c1c1c;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .macro-bar {
            width: 100%;
            height: 8px;
            background: #444;
            border-radius: 8px;
            margin-bottom: 10px;
            position: relative;
        }

        .macro-fill {
            height: 100%;
            border-radius: 8px;
            position: absolute;
            top: 0;
            left: 0;
        }

        .macro-info {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 14px;
            color: #bbb;
        }

        .macro-info span {
            color: #fff;
        }

        .input-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        input[type="number"] {
            padding: 10px;
            font-size: 14px;
            border: 2px solid #333;
            border-radius: 10px;
            background-color: #222;
            color: #fff;
            width: 100px;
            text-align: center;
            transition: border 0.3s ease;
        }

        input[type="number"]:focus {
            border-color: #00d7b7;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            margin: 10px 0;
            color: #bbb;
        }

        button {
            background-color: #00d7b7;
            color: #fff;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 20px;
        }

        button:hover {
            background-color: #00a59b;
        }

        .record {
            background: #2c2c2c;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            box-sizing: border-box;
        }

        .record span {
            color: #bbb;
            font-size: 14px;
        }

        .record button {
            background-color: #ff4f5e;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .record button:hover {
            background-color: #e0333e;
        }

        .records-container {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 30px;
            padding-right: 10px;
        }

        .clear-button {
            background-color: #e0333e;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            color: #fff;
            border: none;
            margin-top: 20px;
        }

        .clear-button:hover {
            background-color: #d1302f;
        }

    </style>
</head>
<body>

<div class="container">
    <h1>КБЖУ калькулятор</h1>
    
    <!-- Макронутриенты -->
    <div class="macro-info">
        <span id="calories-left">Можно съесть еще 1840 калорий</span>
    </div>
    <div class="macro-bar">
        <div id="calories-fill" class="macro-fill" style="width: 0%;"></div>
    </div>

    <div class="macro-info">
        <span id="calories-used" style="color: #68B96A;">0 полученные калории</span>
        <span id="calories-all">Цель: 1840</span>
    </div>

    <!-- Белки, Жиры, Углеводы -->
    <div class="macro-info">
        <span id="protein-used">Белки: съедено 0</span>
        <span id="protein-left">Осталось 138</span>
    </div>
    <div class="macro-bar">
        <div id="protein-fill" class="macro-fill" style="background-color: #43a7fa; width: 0%;"></div>
    </div>

    <div class="macro-info">
        <span id="fat-used">Жиры: съедено 0</span>
        <span id="fat-left">Осталось 69</span>
    </div>
    <div class="macro-bar">
        <div id="fat-fill" class="macro-fill" style="background-color: #fe6e3d; width: 0%;"></div>
    </div>

    <div class="macro-info">
        <span id="carb-used">Углеводы: съедено 0</span>
        <span id="carb-left">Осталось 276</span>
    </div>
    <div class="macro-bar">
        <div id="carb-fill" class="macro-fill" style="background-color: #e5447a; width: 0%;"></div>
    </div>

    <!-- Ввод данных -->
    <div class="input-container">
        <div class="input-row">
            <input type="number" id="fat-input" placeholder="Жиры">
            <input type="number" id="carb-input" placeholder="Углеводы">
            <input type="number" id="protein-input" placeholder="Белки">
        </div>
        <div class="checkbox-label">
            <input type="checkbox" id="training-day" onchange="toggleTrainingDay()">
            <label for="training-day">День тренировки</label>
        </div>
        <button onclick="addRecord()">Добавить</button>
    </div>

    <!-- Записи -->
    <div class="records-container" id="records-container"></div>

    <!-- Очистить все записи -->
    <button class="clear-button" onclick="clearAllRecords()">Удалить все</button>
</div>

<script>
    let records = JSON.parse(localStorage.getItem('records')) || [];
    let totalMacros = JSON.parse(localStorage.getItem('totalMacros')) || { protein: 0, fat: 0, carb: 0 };
    const limits = {
        training: { protein: 138, fat: 69, carb: 276, calories: 2339 },
        rest: { protein: 152, fat: 55, carb: 172, calories: 1840 }
    };
    let isTrainingDay = JSON.parse(localStorage.getItem('isTrainingDay')) || false;
    let editingIndex = null;

    document.addEventListener('DOMContentLoaded', () => {
        updateTable();
        updateUI();
        document.getElementById('training-day').checked = isTrainingDay;
    });

    function toggleTrainingDay() {
        isTrainingDay = document.getElementById('training-day').checked;
        localStorage.setItem('isTrainingDay', JSON.stringify(isTrainingDay));
        updateUI();
    }

    function addRecord() {
        const protein = parseInt(document.getElementById('protein-input').value) || 0;
        const fat = parseInt(document.getElementById('fat-input').value) || 0;
        const carb = parseInt(document.getElementById('carb-input').value) || 0;

        if (editingIndex !== null) {
            totalMacros.protein -= records[editingIndex].protein;
            totalMacros.fat -= records[editingIndex].fat;
            totalMacros.carb -= records[editingIndex].carb;

            records[editingIndex] = { protein, fat, carb, time: records[editingIndex].time };

            totalMacros.protein += protein;
            totalMacros.fat += fat;
            totalMacros.carb += carb;

            editingIndex = null;
            document.querySelector('button').textContent = 'Добавить';
        } else {
            records.push({ protein, fat, carb, time: new Date().toLocaleTimeString() });
            totalMacros.protein += protein;
            totalMacros.fat += fat;
            totalMacros.carb += carb;
        }

        updateTable();
        updateUI();
        localStorage.setItem('records', JSON.stringify(records));
        localStorage.setItem('totalMacros', JSON.stringify(totalMacros));
    }

    function editRecord(index) {
        const record = records[index];
        document.getElementById('protein-input').value = record.protein;
        document.getElementById('fat-input').value = record.fat;
        document.getElementById('carb-input').value = record.carb;
        editingIndex = index;
        document.querySelector('button').textContent = 'Обновить';
    }

    function deleteRecord(index) {
        if (confirm('Вы уверены, что хотите удалить эту запись?')) {
            totalMacros.protein -= records[index].protein;
            totalMacros.fat -= records[index].fat;
            totalMacros.carb -= records[index].carb;

            records.splice(index, 1);

            updateTable();
            updateUI();
            localStorage.setItem('records', JSON.stringify(records));
            localStorage.setItem('totalMacros', JSON.stringify(totalMacros));
        }
    }

    function updateTable() {
        const container = document.getElementById('records-container');
        container.innerHTML = '';
        records.forEach((record, index) => {
            const recordElement = document.createElement('div');
            recordElement.classList.add('record');
            recordElement.innerHTML = `
                <span>${record.time}</span>
                <span>Белки: ${record.protein} г, Жиры: ${record.fat} г, Углеводы: ${record.carb} г</span>
                <button onclick="editRecord(${index})">Изменить</button>
                <button onclick="deleteRecord(${index})">Удалить</button>
            `;
            container.appendChild(recordElement);
        });
    }

    function updateUI() {
        const limitsForDay = isTrainingDay ? limits.training : limits.rest;

        const caloriesLeft = limitsForDay.calories - totalMacros.protein * 4 - totalMacros.fat * 9 - totalMacros.carb * 4;
        const proteinLeft = limitsForDay.protein - totalMacros.protein;
        const fatLeft = limitsForDay.fat - totalMacros.fat;
        const carbLeft = limitsForDay.carb - totalMacros.carb;

        const caloriesPercentage = (totalMacros.protein * 4 + totalMacros.fat * 9 + totalMacros.carb * 4) / limitsForDay.calories * 100;
        const proteinPercentage = totalMacros.protein / limitsForDay.protein * 100;
        const fatPercentage = totalMacros.fat / limitsForDay.fat * 100;
        const carbPercentage = totalMacros.carb / limitsForDay.carb * 100;

        document.getElementById('calories-left').textContent = `Можно съесть еще ${caloriesLeft.toFixed(0)} калорий`;
        document.getElementById('calories-fill').style.width = `${caloriesPercentage}%`;
        document.getElementById('protein-used').textContent = `Белки: съедено ${totalMacros.protein}`;
        document.getElementById('fat-used').textContent = `Жиры: съедено ${totalMacros.fat}`;
        document.getElementById('carb-used').textContent = `Углеводы: съедено ${totalMacros.carb}`;
        document.getElementById('protein-left').textContent = `Осталось ${proteinLeft}`;
        document.getElementById('fat-left').textContent = `Осталось ${fatLeft}`;
        document.getElementById('carb-left').textContent = `Осталось ${carbLeft}`;
        document.getElementById('calories-all').textContent = `Цель: ${limitsForDay.calories}`;
        document.getElementById('protein-fill').style.width = `${proteinPercentage}%`;
        document.getElementById('fat-fill').style.width = `${fatPercentage}%`;
        document.getElementById('carb-fill').style.width = `${carbPercentage}%`;
    }

    function clearAllRecords() {
        if (confirm('Вы уверены, что хотите удалить все записи?')) {
            records = [];
            totalMacros = { protein: 0, fat: 0, carb: 0 };
            updateTable();
            updateUI();
            localStorage.removeItem('records');
            localStorage.removeItem('totalMacros');
        }
    }
</script>
</body>
</html>
